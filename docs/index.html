<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Unity + AR.js</title>

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <!-- Unity loader (fix file name to your own) -->
  <script src="Build/YOURBUILD.loader.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background: #000;
    }

    #hint {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 8px 12px;
      text-align: center;
      font-family: sans-serif;
      font-size: 16px;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      z-index: 1000;
    }

    #unity-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 500;        /* on top of video */
      background: transparent;
    }

    a-scene {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 100;        /* under Unity and hint */
    }
  </style>

  <script>
    let unityInstance = null;

    // Start Unity once the page has loaded
    function startUnity() {
      const canvas = document.getElementById("unity-canvas");

      createUnityInstance(canvas, {
        dataUrl: "Build/YOURBUILD.data",
        frameworkUrl: "Build/YOURBUILD.framework.js",
        codeUrl: "Build/YOURBUILD.wasm",
      }).then(instance => {
        unityInstance = instance;
        console.log("Unity started");
      }).catch(err => {
        console.error(err);
        alert("Unity failed to load, check console for details.");
      });
    }

    // A-Frame component to send marker pose to Unity every frame
    AFRAME.registerComponent('send-pose-to-unity', {
      tick: function () {
        if (!unityInstance) return;

        const obj3D = this.el.object3D;
        if (!obj3D.visible) return;

        const pos = new THREE.Vector3();
        const quat = new THREE.Quaternion();
        const scale = new THREE.Vector3();

        obj3D.matrixWorld.decompose(pos, quat, scale);

        const pose = {
          px: pos.x, py: pos.y, pz: pos.z,
          qx: quat.x, qy: quat.y, qz: quat.z, qw: quat.w
        };

        // GameObject name must match: PoseReceiverGO
        unityInstance.SendMessage("PoseReceiverGO", "SetPose", JSON.stringify(pose));
      }
    });
  </script>
</head>

<body onload="startUnity()">
  <!-- Text above the AR screen -->
  <div id="hint">move the visitenkarte to the camer</div>

  <!-- Unity canvas -->
  <canvas id="unity-canvas"></canvas>

  <!-- AR.js scene: only tracking, no red box any more -->
  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    arjs="sourceType: webcam; debugUIEnabled: true;"
  >
    <a-marker
      type="pattern"
      url="visitenkartenmarker.patt"
      send-pose-to-unity
    >
      <!-- nothing inside; Unity does the visuals -->
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>
</body>
</html>
